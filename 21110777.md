# 21110777, Đào Trung Kiên
# Task: Firewall
## a: Setup rules on router to block all access into it except ping.
<span style="color:blue">- To block all the access except ping we need to set up these following rules: </span><br>
<span style="color:blue">+ First we need to go to the Router and block all access to the Router except for Ping:</span><br>
<img width="726" alt="Screenshot 2023-05-02 165126" src="https://github.com/DoomDayKross/FirewallLab/blob/main/assets/Screenshot%202024-07-14%20163213.png?raw=true"><br>
<span style="color:blue">Accept ping:</span><br></span>
<span style="color:blue">iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT <br>
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT<br>Related and established connections:<br>iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br>+ Then we will block Subnet 10.9.0.0/24 from accessing iweb (172.16.10.110):
<br>Block 10.9.0.0/24 from accessing iweb at 172.16.10.110:<br>iptables -A FORWARD -s 10.9.0.0/24 -d 172.16.10.110 -p tcp --dport 80 -j DROP <br>
iptables -A FORWARD -s 10.9.0.0/24 -d 172.16.10.110 -p tcp --dport 443 -j DROP <br>
iptables -A FORWARD -s 10.9.0.0/24 -d 172.16.10.110 -p tcp --dport 23 -j DROP<br>Block ICMP traffic from 10.9.0.0/24 to 172.16.10.0/24:<br>iptables -A FORWARD -s 10.9.0.0/24 -d 172.16.10.0/24 -p icmp -j DROP<br>+ Next we need to prevent Subnet 172.16.10.0/24 from accessing badsite (10.9.0.10):<br>Block 172.16.10.0/24 from accessing 10.9.0.10:<br>iptables -A FORWARD -s 172.16.10.0/24 -d 10.9.0.10 -p tcp --dport 80 -j DROP<br>
iptables -A FORWARD -s 172.16.10.0/24 -d 10.9.0.10 -p tcp --dport 443 -j DROP<br>
iptables -A FORWARD -s 172.16.10.0/24 -d 10.9.0.10 -p tcp --dport 23 -j DROP<br>Block ICMP traffic from 172.16.10.0/24 to 10.9.0.0/24:<br>iptables -A FORWARD -s 172.16.10.0/24 -d 10.9.0.0/24 -p icmp -j DROP<br>Allow ICMP Traffic and Related/Established Connections in INPUT Chain<br>iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT<br>
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT<br>
iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br>Block the Required specific traffic:<br>Block 10.9.0.0/24 from accessing iweb at 172.16.10.110:<br>
iptables -A FORWARD -s 10.9.0.0/24 -d 172.16.10.110 -p tcp --dport 80 -j DROP<br>
iptables -A FORWARD -s 10.9.0.0/24 -d 172.16.10.110 -p tcp --dport 443 -j DROP<br>Block 172.16.10.0/24 from accessing badsite at 10.9.0.10:<br>
iptables -A FORWARD -s 172.16.10.0/24 -d 10.9.0.10 -p tcp --dport 80 -j DROP<br>
iptables -A FORWARD -s 172.16.10.0/24 -d 10.9.0.10 -p tcp --dport 443 -j DROP<br>- Then finally we save these rules by create iptables folder mkdir -p /etc/iptables and then iptables-save > /etc/iptables/rules.v4<br>- So now when we try to telnet 172.16.10.100 or ping 172.16.10.100 it will not be accessible:<br>
<img width="726" alt="Screenshot 2023-05-02 165126" src="https://github.com/DoomDayKross/FirewallLab/blob/main/assets/Screenshot%202024-07-14%20163829.png?raw=true"><br>
## b: Setup rules on router to prevent computers on subnet 10.9.0.0/24 from accessing the internal web server (iweb).
<span style="color:blue">To archive this we need to block Http and Https:</span><br>
<span style="color:blue">iptables -A OUTPUT -d 172.217.25.14 -p tcp --dport 80 -j REJECT<br>iptables -A OUTPUT -d 172.217.25.14 -p tcp --dport 443 -j REJECT<br>- So now when we try curl http://172.16.10.100 on Outsider and curl http://10.9.0.10 on Insider we will not be able to access:
</span><br>
<span style="color:blue">Outsider: </span><br>
<img width="726" alt="Screenshot 2023-05-02 165126" src="https://github.com/DoomDayKross/FirewallLab/blob/main/assets/Screenshot%202024-07-14%20165212.png?raw=true"><br>
<span style="color:blue">Insider: </span><br>
<img width="726" alt="Screenshot 2023-05-02 165126" src="https://github.com/DoomDayKross/FirewallLab/blob/main/assets/Screenshot%202024-07-14%20165239.png?raw=true"><br>
## c: The badsite was found to contain malwares and source of delivering bots. Setup rules on router to stop computers on subnet 172.16.10.0/24 from accessing the badsite.
<span style="color:blue">- To stop computers on subnet 172.16.10.0/24 from accessing the badsite: iptables -A FORWARD -s 172.16.10.0/24 -d 10.9.0.10 -j REJECT</span><br>
